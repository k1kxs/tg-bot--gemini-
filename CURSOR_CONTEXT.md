# Контекст Проекта: Telegram Бот для Медицинских Работников (Апрель 2025)

## 1. Цель Проекта

Разработать асинхронного Telegram-бота на Python, который будет служить AI-ассистентом для медицинских работников. Бот должен использовать **DeepSeek Chat API (`deepseek-chat`)** для ответов на сложные вопросы, помня контекст беседы.

## 2. Основной Технологический Стек

* **Язык:** Python 3.x (предпочтительно последняя стабильная версия)
* **Telegram Framework:** `aiogram` (версия 3.x или новее)
* **HTTP Клиент (для DeepSeek API):** `aiohttp`
* **Драйвер Базы Данных:** `asyncpg` (для асинхронной работы с PostgreSQL)
* **Управление Секретами:** `.env` файл и библиотека `python-dotenv` / `pydantic-settings`. **Никогда не хардкодить API ключи или URL базы данных в коде!**
* **База Данных:** PostgreSQL, размещенная на **Render** (используется через `DATABASE_URL`).
* **API Модели:** DeepSeek Chat (`deepseek-chat`).

## 3. Ключевые Функции Бота

* **Управление Контекстом:** Бот должен помнить историю диалога с пользователем. Хранить и извлекать последние **10 сообщений** (5 пользователя + 5 ассистента) из PostgreSQL для передачи в DeepSeek API.
* **Системный Промпт:** Использовать кастомный системный промпт (предоставляется отдельно или определяется в коде), ориентированный на предоставление точной, профессиональной медицинской информации.
* **Обработка Ввода:** Обрабатывать текстовые сообщения от пользователя и базовые команды (`/start`, `/clear`).
* **Кнопки:** Использовать `InlineKeyboardMarkup` (aiogram) для интерактивных элементов (например, кнопка "Очистить историю").
* **Обработка Ошибок:** Реализовать надежную обработку ошибок с помощью `try...except` блоков, особенно для сетевых запросов (DeepSeek API, Telegram API) и операций с базой данных. Информировать пользователя об ошибках в понятной форме.
* **Логирование:** Использовать встроенный модуль `logging` Python для записи ключевых событий (запуск, получение сообщения, запрос к API, ответ API, операции с БД, ошибки) на уровне `INFO` и выше в консоль.

## 4. Среда Разработки и Развертывания

* **Локальная Разработка:** macOS. Использовать команды `python3` и `pip3`.
* **Управление Зависимостями:** Через файл `requirements.txt` и `pip3`.
* **Система Контроля Версий:** Предполагается использование Git. При необходимости предоставлять содержимое для `.gitignore`.
* **Платформа Развертывания (Деплой):** **Render** (Web Service для бота + Managed PostgreSQL для базы данных).

## 5. Профиль Пользователя (Инструкции для Тебя, Cursor)

* **Уровень Навыков:** Пользователь идентифицирует себя как **начинающий / не программист**.
* **Стиль Объяснений:** Предоставлять **очень четкие, пошаговые инструкции**. Объяснять **"почему"** код написан именно так, а не только "что" он делает. Избегать сложного жаргона или объяснять его простыми словами. Не делать предположений о наличии у пользователя глубоких знаний в программировании, асинхронности, базах данных или DevOps.
* **Приоритет:** Понятность и простота важнее изощренных, но сложных для понимания решений.

## 6. Стандарты и Предпочтения Кодирования

* **Асинхронность:** **Строго использовать `async/await`** для всех блокирующих операций ввода-вывода (сетевые запросы, работа с БД). Использовать асинхронные версии библиотек (`aiogram`, `aiohttp`, `asyncpg`).
* **Читаемость:** Использовать понятные имена переменных и функций (на английском языке). Добавлять комментарии к неочевидным участкам кода.
* **Типизация:** Использовать аннотации типов Python (`str`, `int`, `list[dict]`, `types.Message`, `asyncpg.Pool` и т.д.).
* **Форматирование:** Использовать f-строки. Придерживаться основных принципов PEP 8 для форматирования кода.
* **Структура Проекта:** Пока придерживаться одного основного файла `main.py`, но быть готовым разбить на модули (`db.py`, `handlers.py`, `config.py`), если сложность возрастет и будет соответствующий запрос.

## 7. Стиль Взаимодействия

* **Генерация Кода:** Предоставлять готовые к использованию фрагменты кода в Markdown блоках.
* **Объяснения:** Сопровождать код детальными, но понятными объяснениями.
* **Декомпозиция:** Разбивать сложные задачи на более мелкие, управляемые шаги.
* **Уточнения:** Задавать уточняющие вопросы, если запрос пользователя неоднозначен.
* **Контекст:** Всегда учитывать предыдущие шаги и созданный код в рамках текущей задачи.

---

**Пожалуйста, придерживайся этих инструкций во всех наших последующих беседах по этому проекту.**